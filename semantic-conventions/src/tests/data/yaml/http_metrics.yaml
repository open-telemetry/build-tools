groups:
  - id: metric.http
    prefix: metric.http
    type: metric
    brief: "This document defines semantic convention for HTTP client and server metrics."
    note: >
        These conventions can be used for http and https schemes
        and various HTTP versions like 1.1, 2 and SPDY.
    attributes:
      - ref: http.method
        required: always
      - ref: http.host
        required:
          conditional: "See attribute alternatives"
      - ref: http.scheme
        required:
          conditional: "See attribute alternative"
      - ref: http.status_code

  - id: metric.http.client
    prefix: metric.http
    type: metric
    extends: metric.http
    brief: 'Semantic Convention for HTTP Client'
    constraints:
      - any_of:
          - [http.url]
          - [http.scheme, http.host, http.target]
          - [http.scheme, net.peer.name, net.peer.port, http.target]
          - [http.scheme, net.peer.ip, net.peer.port, http.target]
    attributes:
      - ref: net.peer.name
      - ref: net.peer.port
      - ref: net.peer.ip
    metrics:
      - id: client.duration
        brief: "Measures the duration of the outbound HTTP request."
        instrument: Histogram
        units: ms

  - id: metric.http.server
    prefix: metric.http
    type: metric
    extends: metric.http
    brief: "Semantic Convention for HTTP Server"
    constraints:
      - any_of:
          - [http.scheme, http.host, http.target]
          - [http.scheme, http.server_name, net.host.port, http.target]
          - [http.scheme, net.host.name, net.host.port, http.target]
          - [http.url]
    attributes:
      - ref: http.server_name
      - ref: net.host.name
      - ref: net.host.port
    metrics:
      - id: server.duration
        brief: "Measures the duration of the inbound HTTP request."
        instrument: Histogram
        units: ms
      - id: server.active_requests
        brief: "Measures the number of concurrent HTTP requests that are currently in-flight."
        instrument: UpDownCounter
        units: "{requests}"
